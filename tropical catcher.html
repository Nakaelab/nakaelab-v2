<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å—å›½ãƒ•ãƒ«ãƒ¼ãƒ„ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  ğŸŒ´</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, #87CEEB 0%, #FFE4B5 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
    }

    .game-container {
      text-align: center;
      color: #333;
    }

    #gameCanvas {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border: 3px solid rgba(255, 255, 255, 0.5);
    }

    .score {
      font-size: 32px;
      font-weight: bold;
      margin-top: 20px;
      text-shadow: 0 2px 10px rgba(255, 255, 255, 0.8);
      color: #2c5530;
    }

    .lives {
      font-size: 24px;
      margin-top: 10px;
      color: #c41e3a;
      font-weight: bold;
    }

    .instructions {
      margin-top: 15px;
      font-size: 16px;
      color: #2c5530;
      font-weight: 600;
    }

    .game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.85);
      padding: 40px 60px;
      border-radius: 20px;
      display: none;
      color: white;
    }

    .game-over h2 {
      font-size: 48px;
      margin-bottom: 20px;
    }

    .game-over button {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      color: #333;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .game-over button:hover {
      transform: scale(1.05);
    }

    .warning {
      color: #ff4444;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div class="score">ğŸ¥¥ ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
    <div class="lives">ğŸ’š ãƒ©ã‚¤ãƒ•: <span id="lives">2</span></div>
    <div class="instructions">â† â†’ ã‚­ãƒ¼ã§ç§»å‹• | <span class="warning">ğŸ¦‚ å°è Ã—2 / å¤§è Ã—1ã§ã‚¢ã‚¦ãƒˆ!</span></div>
  </div>

  <div class="game-over" id="gameOver">
    <h2 id="gameOverTitle">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼!</h2>
    <p style="font-size: 24px; margin-bottom: 30px;">ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></p>
    <button onclick="restartGame()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ ğŸŒ´</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // ã‚²ãƒ¼ãƒ å¤‰æ•°
    let player = {
      x: canvas.width / 2 - 40,
      y: canvas.height - 40,
      width: 80,
      height: 30,
      speed: 8
    };
    
    let fallingObjects = [];
    let score = 0;
    let lives = 2; // ã‚¹ãƒ¢ãƒ¼ãƒ«è ç”¨ã®ãƒ©ã‚¤ãƒ•
    let gameActive = true;
    let keys = {};
    
    // ãƒ•ãƒ«ãƒ¼ãƒ„ã®ç¨®é¡(emoji, points, rarity, size, speed)
    const fruitTypes = [
      { emoji: 'ğŸŒ', points: 5, rarity: 0.25, size: 35, speed: 1.5 },
      { emoji: 'ğŸ', points: 10, rarity: 0.20, size: 35, speed: 1.8 },
      { emoji: 'ğŸŠ', points: 10, rarity: 0.20, size: 35, speed: 1.8 },
      { emoji: 'ğŸ‰', points: 15, rarity: 0.15, size: 45, speed: 1.6 },
      { emoji: 'ğŸ¥­', points: 20, rarity: 0.10, size: 35, speed: 2.2 },
      { emoji: 'ğŸ¥¥', points: 25, rarity: 0.07, size: 38, speed: 2.0 },
      { emoji: 'ğŸ', points: 30, rarity: 0.03, size: 30, speed: 2.8 }
    ];
    
    // ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶(ãƒ¬ã‚¢ãƒªãƒ†ã‚£è€ƒæ…®)
    function selectRandomFruit() {
      const rand = Math.random();
      let cumulativeRarity = 0;
      
      for (const fruit of fruitTypes) {
        cumulativeRarity += fruit.rarity;
        if (rand <= cumulativeRarity) {
          return fruit;
        }
      }
      return fruitTypes[0]; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    }
    
    // è½ã¡ã¦ãã‚‹ç‰©ä½“ã‚’ç”Ÿæˆ
    function createFallingObject() {
      const scorpionChance = Math.random();
      
      if (scorpionChance < 0.10) {
        // 10%ã®ç¢ºç‡ã§ã‚¹ãƒ¢ãƒ¼ãƒ«è 
        return {
          x: Math.random() * (canvas.width - 40) + 20,
          y: -40,
          size: 35,
          speed: 1.8 + Math.random() * 1,
          emoji: 'ğŸ¦‚',
          isScorpion: true,
          isBigScorpion: false,
          points: 0
        };
      } else if (scorpionChance < 0.14) {
        // 4%ã®ç¢ºç‡ã§ãƒ“ãƒƒã‚°è 
        return {
          x: Math.random() * (canvas.width - 50) + 25,
          y: -50,
          size: 55,
          speed: 1.2 + Math.random() * 0.8,
          emoji: 'ğŸ¦‚',
          isScorpion: true,
          isBigScorpion: true,
          points: 0
        };
      } else {
        // ãƒ•ãƒ«ãƒ¼ãƒ„
        const fruit = selectRandomFruit();
        return {
          x: Math.random() * (canvas.width - 40) + 20,
          y: -40,
          size: fruit.size,
          speed: fruit.speed + Math.random() * 0.5,
          emoji: fruit.emoji,
          isScorpion: false,
          isBigScorpion: false,
          points: fruit.points
        };
      }
    }
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼(ã‹ã”)ã‚’æç”»
    function drawPlayer() {
      ctx.font = '60px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('ğŸ§º', player.x + player.width / 2, player.y + player.height / 2);
    }
    
    // è½ä¸‹ç‰©ã‚’æç”»
    function drawFallingObject(obj) {
      ctx.font = obj.size + 'px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      // è ã¯å°‘ã—æºã‚Œã‚‹æ¼”å‡º
      if (obj.isScorpion) {
        const wobble = Math.sin(Date.now() / 100) * 3;
        ctx.fillText(obj.emoji, obj.x + wobble, obj.y);
        
        // ãƒ“ãƒƒã‚°è ã«ã¯è­¦å‘Šãƒãƒ¼ã‚¯
        if (obj.isBigScorpion) {
          ctx.font = '16px serif';
          ctx.fillText('âš ï¸', obj.x + wobble, obj.y - 35);
        }
      } else {
        ctx.fillText(obj.emoji, obj.x, obj.y);
        
        // ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º(é«˜å¾—ç‚¹ãƒ•ãƒ«ãƒ¼ãƒ„ã®ã¿)
        if (obj.points >= 20) {
          ctx.font = '14px Arial';
          ctx.fillStyle = '#FFD700';
          ctx.strokeStyle = '#000';
          ctx.lineWidth = 2;
          ctx.strokeText('+' + obj.points, obj.x, obj.y + 30);
          ctx.fillText('+' + obj.points, obj.x, obj.y + 30);
        }
      }
    }
    
    // è¡çªåˆ¤å®š
    function checkCollision(obj) {
      return (
        obj.y + obj.size / 2 >= player.y &&
        obj.y - obj.size / 2 <= player.y + player.height &&
        obj.x + obj.size / 2 >= player.x &&
        obj.x - obj.size / 2 <= player.x + player.width
      );
    }
    
    // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
    function gameLoop() {
      if (!gameActive) return;
      
      // èƒŒæ™¯ã‚¯ãƒªã‚¢
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•
      if (keys['ArrowLeft'] && player.x > 0) {
        player.x -= player.speed;
      }
      if (keys['ArrowRight'] && player.x < canvas.width - player.width) {
        player.x += player.speed;
      }
      
      // è½ä¸‹ç‰©ã‚’ç”Ÿæˆ
      if (Math.random() < 0.020) {
        fallingObjects.push(createFallingObject());
      }
      
      // è½ä¸‹ç‰©ã‚’æ›´æ–°ãƒ»æç”»
      for (let i = fallingObjects.length - 1; i >= 0; i--) {
        const obj = fallingObjects[i];
        obj.y += obj.speed;
        
        // ã‚­ãƒ£ãƒƒãƒåˆ¤å®š
        if (checkCollision(obj)) {
          if (obj.isScorpion) {
            if (obj.isBigScorpion) {
              // ãƒ“ãƒƒã‚°è  â†’ å³æ­»!
              endGame('bigScorpion');
              return;
            } else {
              // ã‚¹ãƒ¢ãƒ¼ãƒ«è  â†’ ãƒ©ã‚¤ãƒ•æ¸›å°‘
              lives--;
              document.getElementById('lives').textContent = lives;
              
              if (lives < 0) {
                endGame('smallScorpion');
                return;
              }
            }
          } else {
            // ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’ã‚­ãƒ£ãƒƒãƒ â†’ ã‚¹ã‚³ã‚¢ã‚¢ãƒƒãƒ—!
            score += obj.points;
            document.getElementById('score').textContent = score;
          }
          fallingObjects.splice(i, 1);
          continue;
        }
        
        // åœ°é¢ã«è½ã¡ãŸå ´åˆ(ãƒ•ãƒ«ãƒ¼ãƒ„ã®ã¿ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼)
        if (obj.y > canvas.height + 50) {
          if (!obj.isScorpion) {
            endGame('missed');
            return;
          }
          fallingObjects.splice(i, 1);
          continue;
        }
        
        drawFallingObject(obj);
      }
      
      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æç”»
      drawPlayer();
      
      requestAnimationFrame(gameLoop);
    }
    
    // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
    function endGame(reason) {
      gameActive = false;
      document.getElementById('finalScore').textContent = score;
      
      if (reason === 'bigScorpion') {
        document.getElementById('gameOverTitle').textContent = 'ğŸ¦‚ğŸ’€ ãƒ“ãƒƒã‚°è ã«åˆºã•ã‚ŒãŸ!';
      } else if (reason === 'smallScorpion') {
        document.getElementById('gameOverTitle').textContent = 'ğŸ¦‚ğŸ¦‚ ã‚¹ãƒ¢ãƒ¼ãƒ«è ã§ãƒ©ã‚¤ãƒ•å°½ããŸ!';
      } else {
        document.getElementById('gameOverTitle').textContent = 'ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’é€ƒã—ãŸ! ğŸ˜¢';
      }
      
      document.getElementById('gameOver').style.display = 'block';
    }
    
    // ã‚²ãƒ¼ãƒ å†é–‹
    function restartGame() {
      score = 0;
      lives = 2;
      fallingObjects = [];
      gameActive = true;
      player.x = canvas.width / 2 - 40;
      document.getElementById('score').textContent = '0';
      document.getElementById('lives').textContent = '2';
      document.getElementById('gameOver').style.display = 'none';
      gameLoop();
    }
    
    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›
    document.addEventListener('keydown', (e) => {
      keys[e.key] = true;
    });
    
    document.addEventListener('keyup', (e) => {
      keys[e.key] = false;
    });
    
    // ã‚²ãƒ¼ãƒ é–‹å§‹
    gameLoop();
  </script>
</body>
</html>