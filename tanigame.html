<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>å—å›½ãƒ•ãƒ«ãƒ¼ãƒ„ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  ğŸŒ´</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-user-select: none;
      user-select: none;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, #87CEEB 0%, #FFE4B5 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      touch-action: none;
    }

    .game-container {
      text-align: center;
      color: #333;
      width: 100%;
      max-width: 500px;
      padding: 10px;
    }

    #gameCanvas {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border: 3px solid rgba(255, 255, 255, 0.5);
      touch-action: none;
      max-width: 100%;
      height: auto;
    }

    .score {
      font-size: 24px;
      font-weight: bold;
      margin-top: 10px;
      text-shadow: 0 2px 10px rgba(255, 255, 255, 0.8);
      color: #2c5530;
    }

    .lives {
      font-size: 20px;
      margin-top: 6px;
      color: #c41e3a;
      font-weight: bold;
    }

    .scorpion-counter {
      font-size: 16px;
      margin-top: 6px;
      color: #ff6600;
      font-weight: bold;
      min-height: 24px;
    }

    .instructions {
      margin-top: 10px;
      font-size: 13px;
      color: #2c5530;
      font-weight: 600;
      line-height: 1.4;
      padding: 0 10px;
    }

    /* èª¬æ˜ç”»é¢ */
    .tutorial-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 20px;
    }

    .tutorial-content {
      background: linear-gradient(135deg, #FFE4B5 0%, #FFDAB9 100%);
      padding: 30px;
      border-radius: 20px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .tutorial-content h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: #2c5530;
      text-align: center;
    }

    .tutorial-section {
      margin-bottom: 20px;
      background: rgba(255, 255, 255, 0.6);
      padding: 15px;
      border-radius: 10px;
    }

    .tutorial-section h2 {
      font-size: 20px;
      margin-bottom: 10px;
      color: #2c5530;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tutorial-section p {
      font-size: 15px;
      line-height: 1.6;
      color: #333;
      margin-bottom: 8px;
    }

    .tutorial-section .highlight {
      background: #fff59d;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }

    .start-button {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: white;
      border: none;
      padding: 18px 50px;
      font-size: 20px;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s;
      width: 100%;
      margin-top: 10px;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
    }

    .start-button:active {
      transform: scale(0.95);
    }

    /* ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ */
    .game-over {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 30px 40px;
      border-radius: 20px;
      display: none;
      color: white;
      z-index: 1000;
      max-width: 90%;
      text-align: center;
    }

    .game-over h2 {
      font-size: 24px;
      margin-bottom: 15px;
      line-height: 1.3;
    }

    .game-over p {
      font-size: 20px;
      margin-bottom: 25px;
    }

    .game-over button {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      color: #333;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .game-over button:active {
      transform: scale(0.95);
    }

    @media (max-width: 480px) {
      .tutorial-content {
        padding: 20px;
      }
      
      .tutorial-content h1 {
        font-size: 24px;
      }
      
      .tutorial-section h2 {
        font-size: 18px;
      }
      
      .tutorial-section p {
        font-size: 14px;
      }
      
      .score {
        font-size: 20px;
      }
      
      .lives {
        font-size: 18px;
      }
      
      .scorpion-counter {
        font-size: 14px;
      }
      
      .instructions {
        font-size: 11px;
      }
      
      .game-over h2 {
        font-size: 20px;
      }
      
      .game-over p {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <!-- èª¬æ˜ç”»é¢ -->
  <div class="tutorial-screen" id="tutorialScreen">
    <div class="tutorial-content">
      <h1>ğŸŒ´ å—å›½ãƒ•ãƒ«ãƒ¼ãƒ„ã‚­ãƒ£ãƒƒãƒ ğŸŒ´</h1>
      
      <div class="tutorial-section">
        <h2>ğŸ¯ ã‚²ãƒ¼ãƒ ã®ç›®çš„</h2>
        <p>ã‹ã”ğŸ§ºã‚’å‹•ã‹ã—ã¦ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’ã‚­ãƒ£ãƒƒãƒ!<br>ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’1ã¤ã§ã‚‚é€ƒã—ãŸã‚‰<span class="highlight">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</span></p>
      </div>
      
      <div class="tutorial-section">
        <h2>ğŸŒ ãƒ•ãƒ«ãƒ¼ãƒ„ã®ç¨®é¡</h2>
        <p>ğŸŒãƒãƒŠãƒŠ(5ç‚¹) ğŸã‚Šã‚“ã”(10ç‚¹) ğŸŠã¿ã‹ã‚“(10ç‚¹)</p>
        <p>ğŸ‰ã™ã„ã‹(15ç‚¹) ğŸ¥­ãƒãƒ³ã‚´ãƒ¼(20ç‚¹) ğŸ¥¥ã‚³ã‚³ãƒŠãƒƒãƒ„(25ç‚¹)</p>
        <p>ğŸãƒ‘ã‚¤ãƒŠãƒƒãƒ—ãƒ«(30ç‚¹) â† ãƒ¬ã‚¢!</p>
      </div>
      
      <div class="tutorial-section">
        <h2>ğŸ’š ãƒ©ã‚¤ãƒ•ã‚·ã‚¹ãƒ†ãƒ </h2>
        <p>ãƒ©ã‚¤ãƒ•ã¯<span class="highlight">3ã¤</span>ã‚¹ã‚¿ãƒ¼ãƒˆ!<br>ãƒ©ã‚¤ãƒ•ãŒ0ã«ãªã£ãŸã‚‰ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</p>
      </div>
      
      <div class="tutorial-section">
        <h2>ğŸ¦‚ ã‚µã‚½ãƒªã«æ³¨æ„!</h2>
        <p><strong>å°ã‚µã‚½ãƒªğŸ¦‚:</strong> <span class="highlight">3å›å½“ãŸã‚‹</span>ã¨ãƒ©ã‚¤ãƒ•-1<br>
        å½“ãŸã£ãŸå›æ•°ã¯ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
        <p><strong>å¤§ã‚µã‚½ãƒªâš ï¸ğŸ¦‚:</strong> <span class="highlight">1å›ã§</span>ãƒ©ã‚¤ãƒ•-1<br>
        ã§ã‹ã„ã®ã§é¿ã‘ã‚„ã™ã„ã‚ˆ!</p>
      </div>
      
      <div class="tutorial-section">
        <h2>ğŸ® æ“ä½œæ–¹æ³•</h2>
        <p><strong>ã‚¹ãƒãƒ›:</strong> ç”»é¢ã‚¿ãƒƒãƒã§ã‹ã”ã‚’ç§»å‹•</p>
        <p><strong>PC:</strong> â† â†’ ã‚­ãƒ¼ã§ç§»å‹•</p>
      </div>
      
      <button class="start-button" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ! ğŸš€</button>
    </div>
  </div>

  <div class="game-container">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div class="score">ğŸ¥¥ ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
    <div class="lives">ğŸ’š ãƒ©ã‚¤ãƒ•: <span id="lives">3</span></div>
    <div class="scorpion-counter" id="scorpionCounter"></div>
    <div class="instructions">
      ğŸ¦‚ å°ã‚µã‚½ãƒª3å› / å¤§ã‚µã‚½ãƒªâš ï¸1å›ã§ãƒ©ã‚¤ãƒ•-1<br>
      ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’é€ƒã™ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼!
    </div>
  </div>

  <div class="game-over" id="gameOver">
    <h2 id="gameOverTitle">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼!</h2>
    <p>ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></p>
    <button onclick="restartGame()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ ğŸŒ´</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // ã‚²ãƒ¼ãƒ å¤‰æ•°
    let player = {
      x: canvas.width / 2 - 40,
      y: canvas.height - 40,
      width: 80,
      height: 30,
      speed: 8
    };
    
    let fallingObjects = [];
    let score = 0;
    let lives = 3;  // ãƒ©ã‚¤ãƒ•3ã¤ã‚¹ã‚¿ãƒ¼ãƒˆ
    let smallScorpionHits = 0;  // å°ã‚µã‚½ãƒªãƒ’ãƒƒãƒˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
    let gameActive = false;  // æœ€åˆã¯èª¬æ˜ç”»é¢è¡¨ç¤ºã®ãŸã‚false
    let keys = {};
    let touchActive = false;
    let touchX = 0;
    
    // ãƒ•ãƒ«ãƒ¼ãƒ„ã®ç¨®é¡
    const fruitTypes = [
      { emoji: 'ğŸŒ', points: 5, rarity: 0.25, size: 35, speed: 1.5 },
      { emoji: 'ğŸ', points: 10, rarity: 0.20, size: 35, speed: 1.8 },
      { emoji: 'ğŸŠ', points: 10, rarity: 0.20, size: 35, speed: 1.8 },
      { emoji: 'ğŸ‰', points: 15, rarity: 0.15, size: 45, speed: 1.6 },
      { emoji: 'ğŸ¥­', points: 20, rarity: 0.10, size: 35, speed: 2.2 },
      { emoji: 'ğŸ¥¥', points: 25, rarity: 0.07, size: 38, speed: 2.0 },
      { emoji: 'ğŸ', points: 30, rarity: 0.03, size: 30, speed: 2.8 }
    ];
    
    // ã‚¿ãƒƒãƒ/ãƒã‚¦ã‚¹æ“ä½œ
    function getTouchPos(e) {
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches ? e.touches[0] : e;
      return touch.clientX - rect.left;
    }
    
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      touchActive = true;
      touchX = getTouchPos(e);
    });
    
    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (touchActive) {
        touchX = getTouchPos(e);
      }
    });
    
    canvas.addEventListener('touchend', (e) => {
      e.preventDefault();
      touchActive = false;
    });
    
    // ãƒã‚¦ã‚¹å¯¾å¿œ(ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã‚‚å‹•ã)
    canvas.addEventListener('mousedown', (e) => {
      touchActive = true;
      touchX = getTouchPos(e);
    });
    
    canvas.addEventListener('mousemove', (e) => {
      if (touchActive) {
        touchX = getTouchPos(e);
      }
    });
    
    canvas.addEventListener('mouseup', () => {
      touchActive = false;
    });
    
    // ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶
    function selectRandomFruit() {
      const rand = Math.random();
      let cumulativeRarity = 0;
      
      for (const fruit of fruitTypes) {
        cumulativeRarity += fruit.rarity;
        if (rand <= cumulativeRarity) {
          return fruit;
        }
      }
      return fruitTypes[0];
    }
    
    // è½ã¡ã¦ãã‚‹ç‰©ä½“ã‚’ç”Ÿæˆ
    function createFallingObject() {
      const scorpionChance = Math.random();
      
      if (scorpionChance < 0.10) {
        // å°ã‚µã‚½ãƒª
        return {
          x: Math.random() * (canvas.width - 40) + 20,
          y: -40,
          size: 35,
          speed: 1.8 + Math.random() * 1,
          emoji: 'ğŸ¦‚',
          isScorpion: true,
          isBigScorpion: false,
          points: 0
        };
      } else if (scorpionChance < 0.14) {
        // å¤§ã‚µã‚½ãƒª
        return {
          x: Math.random() * (canvas.width - 50) + 25,
          y: -50,
          size: 55,
          speed: 1.2 + Math.random() * 0.8,
          emoji: 'ğŸ¦‚',
          isScorpion: true,
          isBigScorpion: true,
          points: 0
        };
      } else {
        // ãƒ•ãƒ«ãƒ¼ãƒ„
        const fruit = selectRandomFruit();
        return {
          x: Math.random() * (canvas.width - 40) + 20,
          y: -40,
          size: fruit.size,
          speed: fruit.speed + Math.random() * 0.5,
          emoji: fruit.emoji,
          isScorpion: false,
          isBigScorpion: false,
          points: fruit.points
        };
      }
    }
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼(ã‹ã”)ã‚’æç”»
    function drawPlayer() {
      ctx.font = '60px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('ğŸ§º', player.x + player.width / 2, player.y + player.height / 2);
    }
    
    // è½ä¸‹ç‰©ã‚’æç”»
    function drawFallingObject(obj) {
      ctx.font = obj.size + 'px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      if (obj.isScorpion) {
        const wobble = Math.sin(Date.now() / 100) * 3;
        ctx.fillText(obj.emoji, obj.x + wobble, obj.y);
        
        if (obj.isBigScorpion) {
          ctx.font = '16px serif';
          ctx.fillText('âš ï¸', obj.x + wobble, obj.y - 35);
        }
      } else {
        ctx.fillText(obj.emoji, obj.x, obj.y);
        
        if (obj.points >= 20) {
          ctx.font = '14px Arial';
          ctx.fillStyle = '#FFD700';
          ctx.strokeStyle = '#000';
          ctx.lineWidth = 2;
          ctx.strokeText('+' + obj.points, obj.x, obj.y + 30);
          ctx.fillText('+' + obj.points, obj.x, obj.y + 30);
        }
      }
    }
    
    // è¡çªåˆ¤å®š
    function checkCollision(obj) {
      return (
        obj.y + obj.size / 2 >= player.y &&
        obj.y - obj.size / 2 <= player.y + player.height &&
        obj.x + obj.size / 2 >= player.x &&
        obj.x - obj.size / 2 <= player.x + player.width
      );
    }
    
    // å°ã‚µã‚½ãƒªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼è¡¨ç¤ºæ›´æ–°
    function updateScorpionCounter() {
      const counterElement = document.getElementById('scorpionCounter');
      if (smallScorpionHits > 0) {
        counterElement.textContent = `âš ï¸ å°ã‚µã‚½ãƒªãƒ’ãƒƒãƒˆ: ${smallScorpionHits}/3`;
      } else {
        counterElement.textContent = '';
      }
    }
    
    // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
    function gameLoop() {
      if (!gameActive) return;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // ã‚¿ãƒƒãƒæ“ä½œ
      if (touchActive) {
        const targetX = touchX - player.width / 2;
        player.x = Math.max(0, Math.min(canvas.width - player.width, targetX));
      }
      
      // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
      if (keys['ArrowLeft'] && player.x > 0) {
        player.x -= player.speed;
      }
      if (keys['ArrowRight'] && player.x < canvas.width - player.width) {
        player.x += player.speed;
      }
      
      // è½ä¸‹ç‰©ã‚’ç”Ÿæˆ
      if (Math.random() < 0.020) {
        fallingObjects.push(createFallingObject());
      }
      
      // è½ä¸‹ç‰©ã‚’æ›´æ–°ãƒ»æç”»
      for (let i = fallingObjects.length - 1; i >= 0; i--) {
        const obj = fallingObjects[i];
        obj.y += obj.speed;
        
        if (checkCollision(obj)) {
          if (obj.isScorpion) {
            if (obj.isBigScorpion) {
              // å¤§ã‚µã‚½ãƒª: 1å›ã§ãƒ©ã‚¤ãƒ•-1
              lives--;
              document.getElementById('lives').textContent = lives;
              
              if (lives <= 0) {
                endGame('bigScorpion');
                return;
              }
            } else {
              // å°ã‚µã‚½ãƒª: 3å›ã§ãƒ©ã‚¤ãƒ•-1
              smallScorpionHits++;
              updateScorpionCounter();
              
              if (smallScorpionHits >= 3) {
                lives--;
                document.getElementById('lives').textContent = lives;
                smallScorpionHits = 0;  // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ
                updateScorpionCounter();
                
                if (lives <= 0) {
                  endGame('smallScorpion');
                  return;
                }
              }
            }
          } else {
            // ãƒ•ãƒ«ãƒ¼ãƒ„
            score += obj.points;
            document.getElementById('score').textContent = score;
          }
          fallingObjects.splice(i, 1);
          continue;
        }
        
        if (obj.y > canvas.height + 50) {
          if (!obj.isScorpion) {
            // ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’é€ƒã—ãŸ
            endGame('missed');
            return;
          }
          fallingObjects.splice(i, 1);
          continue;
        }
        
        drawFallingObject(obj);
      }
      
      drawPlayer();
      requestAnimationFrame(gameLoop);
    }
    
    // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
    function endGame(reason) {
      gameActive = false;
      document.getElementById('finalScore').textContent = score;
      
      if (reason === 'bigScorpion') {
        document.getElementById('gameOverTitle').textContent = 'ğŸ¦‚ğŸ’” å¤§ã‚µã‚½ãƒªã§ãƒ©ã‚¤ãƒ•å°½ããŸ!';
      } else if (reason === 'smallScorpion') {
        document.getElementById('gameOverTitle').textContent = 'ğŸ¦‚ğŸ¦‚ğŸ¦‚ å°ã‚µã‚½ãƒª3å›ã§ãƒ©ã‚¤ãƒ•å°½ããŸ!';
      } else {
        document.getElementById('gameOverTitle').textContent = 'ğŸ˜¢ ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’é€ƒã—ãŸ!';
      }
      
      document.getElementById('gameOver').style.display = 'block';
    }
    
    // èª¬æ˜ç”»é¢ã‚’é–‰ã˜ã¦ã‚²ãƒ¼ãƒ é–‹å§‹
    function startGame() {
      document.getElementById('tutorialScreen').style.display = 'none';
      gameActive = true;
      gameLoop();
    }
    
    // ã‚²ãƒ¼ãƒ å†é–‹
    function restartGame() {
      score = 0;
      lives = 3;
      smallScorpionHits = 0;
      fallingObjects = [];
      gameActive = true;
      player.x = canvas.width / 2 - 40;
      document.getElementById('score').textContent = '0';
      document.getElementById('lives').textContent = '3';
      updateScorpionCounter();
      document.getElementById('gameOver').style.display = 'none';
      gameLoop();
    }
    
    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›
    document.addEventListener('keydown', (e) => {
      keys[e.key] = true;
    });
    
    document.addEventListener('keyup', (e) => {
      keys[e.key] = false;
    });
  </script>
</body>
</html>