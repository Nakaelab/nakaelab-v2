<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>å—å›½ãƒ•ãƒ«ãƒ¼ãƒ„ã‚­ãƒ£ãƒƒãƒã‚²ãƒ¼ãƒ  ğŸŒ´</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-user-select: none;
      user-select: none;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, #87CEEB 0%, #FFE4B5 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      touch-action: none;
    }

    .game-container {
      text-align: center;
      color: #333;
    }

    #gameCanvas {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      border: 3px solid rgba(255, 255, 255, 0.5);
      touch-action: none;
    }

    .score {
      font-size: 28px;
      font-weight: bold;
      margin-top: 15px;
      text-shadow: 0 2px 10px rgba(255, 255, 255, 0.8);
      color: #2c5530;
    }

    .lives {
      font-size: 20px;
      margin-top: 8px;
      color: #c41e3a;
      font-weight: bold;
    }

    .instructions {
      margin-top: 12px;
      font-size: 14px;
      color: #2c5530;
      font-weight: 600;
    }

    .game-over {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      padding: 30px 50px;
      border-radius: 20px;
      display: none;
      color: white;
      z-index: 1000;
    }

    .game-over h2 {
     font-size: 28px;
     margin-bottom: 15px;
     writing-mode: horizontal-tb;  /* æ¨ªæ›¸ãå¼·åˆ¶ */
      white-space: nowrap;  /* æ”¹è¡Œã•ã›ãªã„ */
    }

    .game-over button {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      color: #333;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .game-over button:active {
      transform: scale(0.95);
    }

    .warning {
      color: #ff4444;
      font-weight: bold;
    }

    @media (max-width: 480px) {
      .score {
        font-size: 24px;
      }
      .lives {
        font-size: 18px;
      }
      .instructions {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div class="score">ğŸ¥¥ ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
    <div class="lives">ğŸ’š ãƒ©ã‚¤ãƒ•: <span id="lives">2</span></div>
    <div class="instructions">ç”»é¢ã‚¿ãƒƒãƒã¾ãŸã¯â† â†’ ã‚­ãƒ¼ã§ç§»å‹• | <span class="warning">ğŸ¦‚ å°è Ã—2 / å¤§è Ã—1ã§ã‚¢ã‚¦ãƒˆ!</span></div>
  </div>

  <div class="game-over" id="gameOver">
    <h2 id="gameOverTitle">ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼!</h2>
    <p style="font-size: 22px; margin-bottom: 25px;">ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span></p>
    <button onclick="restartGame()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ ğŸŒ´</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // ã‚²ãƒ¼ãƒ å¤‰æ•°
    let player = {
      x: canvas.width / 2 - 40,
      y: canvas.height - 40,
      width: 80,
      height: 30,
      speed: 8
    };
    
    let fallingObjects = [];
    let score = 0;
    let lives = 2;
    let gameActive = true;
    let keys = {};
    let touchActive = false;
    let touchX = 0;
    
    // ãƒ•ãƒ«ãƒ¼ãƒ„ã®ç¨®é¡
    const fruitTypes = [
      { emoji: 'ğŸŒ', points: 5, rarity: 0.25, size: 35, speed: 1.5 },
      { emoji: 'ğŸ', points: 10, rarity: 0.20, size: 35, speed: 1.8 },
      { emoji: 'ğŸŠ', points: 10, rarity: 0.20, size: 35, speed: 1.8 },
      { emoji: 'ğŸ‰', points: 15, rarity: 0.15, size: 45, speed: 1.6 },
      { emoji: 'ğŸ¥­', points: 20, rarity: 0.10, size: 35, speed: 2.2 },
      { emoji: 'ğŸ¥¥', points: 25, rarity: 0.07, size: 38, speed: 2.0 },
      { emoji: 'ğŸ', points: 30, rarity: 0.03, size: 30, speed: 2.8 }
    ];
    
    // ã‚¿ãƒƒãƒ/ãƒã‚¦ã‚¹æ“ä½œ
    function getTouchPos(e) {
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches ? e.touches[0] : e;
      return touch.clientX - rect.left;
    }
    
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      touchActive = true;
      touchX = getTouchPos(e);
    });
    
    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (touchActive) {
        touchX = getTouchPos(e);
      }
    });
    
    canvas.addEventListener('touchend', (e) => {
      e.preventDefault();
      touchActive = false;
    });
    
    // ãƒã‚¦ã‚¹å¯¾å¿œ(ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã‚‚å‹•ã)
    canvas.addEventListener('mousedown', (e) => {
      touchActive = true;
      touchX = getTouchPos(e);
    });
    
    canvas.addEventListener('mousemove', (e) => {
      if (touchActive) {
        touchX = getTouchPos(e);
      }
    });
    
    canvas.addEventListener('mouseup', () => {
      touchActive = false;
    });
    
    // ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶
    function selectRandomFruit() {
      const rand = Math.random();
      let cumulativeRarity = 0;
      
      for (const fruit of fruitTypes) {
        cumulativeRarity += fruit.rarity;
        if (rand <= cumulativeRarity) {
          return fruit;
        }
      }
      return fruitTypes[0];
    }
    
    // è½ã¡ã¦ãã‚‹ç‰©ä½“ã‚’ç”Ÿæˆ
    function createFallingObject() {
      const scorpionChance = Math.random();
      
      if (scorpionChance < 0.10) {
        return {
          x: Math.random() * (canvas.width - 40) + 20,
          y: -40,
          size: 35,
          speed: 1.8 + Math.random() * 1,
          emoji: 'ğŸ¦‚',
          isScorpion: true,
          isBigScorpion: false,
          points: 0
        };
      } else if (scorpionChance < 0.14) {
        return {
          x: Math.random() * (canvas.width - 50) + 25,
          y: -50,
          size: 55,
          speed: 1.2 + Math.random() * 0.8,
          emoji: 'ğŸ¦‚',
          isScorpion: true,
          isBigScorpion: true,
          points: 0
        };
      } else {
        const fruit = selectRandomFruit();
        return {
          x: Math.random() * (canvas.width - 40) + 20,
          y: -40,
          size: fruit.size,
          speed: fruit.speed + Math.random() * 0.5,
          emoji: fruit.emoji,
          isScorpion: false,
          isBigScorpion: false,
          points: fruit.points
        };
      }
    }
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼(ã‹ã”)ã‚’æç”»
    function drawPlayer() {
      ctx.font = '60px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('ğŸ§º', player.x + player.width / 2, player.y + player.height / 2);
    }
    
    // è½ä¸‹ç‰©ã‚’æç”»
    function drawFallingObject(obj) {
      ctx.font = obj.size + 'px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      if (obj.isScorpion) {
        const wobble = Math.sin(Date.now() / 100) * 3;
        ctx.fillText(obj.emoji, obj.x + wobble, obj.y);
        
        if (obj.isBigScorpion) {
          ctx.font = '16px serif';
          ctx.fillText('âš ï¸', obj.x + wobble, obj.y - 35);
        }
      } else {
        ctx.fillText(obj.emoji, obj.x, obj.y);
        
        if (obj.points >= 20) {
          ctx.font = '14px Arial';
          ctx.fillStyle = '#FFD700';
          ctx.strokeStyle = '#000';
          ctx.lineWidth = 2;
          ctx.strokeText('+' + obj.points, obj.x, obj.y + 30);
          ctx.fillText('+' + obj.points, obj.x, obj.y + 30);
        }
      }
    }
    
    // è¡çªåˆ¤å®š
    function checkCollision(obj) {
      return (
        obj.y + obj.size / 2 >= player.y &&
        obj.y - obj.size / 2 <= player.y + player.height &&
        obj.x + obj.size / 2 >= player.x &&
        obj.x - obj.size / 2 <= player.x + player.width
      );
    }
    
    // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
    function gameLoop() {
      if (!gameActive) return;
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // ã‚¿ãƒƒãƒæ“ä½œ
      if (touchActive) {
        const targetX = touchX - player.width / 2;
        player.x = Math.max(0, Math.min(canvas.width - player.width, targetX));
      }
      
      // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
      if (keys['ArrowLeft'] && player.x > 0) {
        player.x -= player.speed;
      }
      if (keys['ArrowRight'] && player.x < canvas.width - player.width) {
        player.x += player.speed;
      }
      
      // è½ä¸‹ç‰©ã‚’ç”Ÿæˆ
      if (Math.random() < 0.020) {
        fallingObjects.push(createFallingObject());
      }
      
      // è½ä¸‹ç‰©ã‚’æ›´æ–°ãƒ»æç”»
      for (let i = fallingObjects.length - 1; i >= 0; i--) {
        const obj = fallingObjects[i];
        obj.y += obj.speed;
        
        if (checkCollision(obj)) {
          if (obj.isScorpion) {
            if (obj.isBigScorpion) {
              endGame('bigScorpion');
              return;
            } else {
              lives--;
              document.getElementById('lives').textContent = lives;
              
              if (lives < 0) {
                endGame('smallScorpion');
                return;
              }
            }
          } else {
            score += obj.points;
            document.getElementById('score').textContent = score;
          }
          fallingObjects.splice(i, 1);
          continue;
        }
        
        if (obj.y > canvas.height + 50) {
          if (!obj.isScorpion) {
            endGame('missed');
            return;
          }
          fallingObjects.splice(i, 1);
          continue;
        }
        
        drawFallingObject(obj);
      }
      
      drawPlayer();
      requestAnimationFrame(gameLoop);
    }
    
    // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
    function endGame(reason) {
      gameActive = false;
      document.getElementById('finalScore').textContent = score;
      
      if (reason === 'bigScorpion') {
        document.getElementById('gameOverTitle').textContent = 'ğŸ¦‚ğŸ’€ ãƒ“ãƒƒã‚°è ã«åˆºã•ã‚ŒãŸ!';
      } else if (reason === 'smallScorpion') {
        document.getElementById('gameOverTitle').textContent = 'ğŸ¦‚ğŸ¦‚ ã‚¹ãƒ¢ãƒ¼ãƒ«è ã§ãƒ©ã‚¤ãƒ•å°½ããŸ!';
      } else {
        document.getElementById('gameOverTitle').textContent = 'ğŸ˜¢ ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’é€ƒã—ãŸ!';
      }
      
      document.getElementById('gameOver').style.display = 'block';
    }
    
    // ã‚²ãƒ¼ãƒ å†é–‹
    function restartGame() {
      score = 0;
      lives = 2;
      fallingObjects = [];
      gameActive = true;
      player.x = canvas.width / 2 - 40;
      document.getElementById('score').textContent = '0';
      document.getElementById('lives').textContent = '2';
      document.getElementById('gameOver').style.display = 'none';
      gameLoop();
    }
    
    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›
    document.addEventListener('keydown', (e) => {
      keys[e.key] = true;
    });
    
    document.addEventListener('keyup', (e) => {
      keys[e.key] = false;
    });
    
    // ã‚²ãƒ¼ãƒ é–‹å§‹
    gameLoop();
  </script>
</body>
</html>